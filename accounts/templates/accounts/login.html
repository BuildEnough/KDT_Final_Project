{% extends 'base.html' %}

{% load static %}
{% load widget_tweaks %}
{% load django_bootstrap5 %}
{% load imagekit %}
{% load socialaccount %}
{% providers_media_js %}

{% block title %} | 로그인{% endblock title %}
{% block style %}{% endblock style %}
{% block content %}

<section class="container signup-wrapper">
  <h2 class="text-center">로그인</h2>
  <form action="{% url 'accounts:login' %}" method="POST" class="d-flex flex-column align-items-center" onsubmit="return frm_check();">
    {% csrf_token %}
    <label for="email">아이디</label>
    {% render_field form.username class="user-input" placeholder="이메일을 입력하세요" type="text" name="email" id="logId" %}
    <label for="password">비밀번호</label>
    {% render_field form.password class="user-input" placeholder="비밀번호를 입력하세요" type="password" name="password" autocomplete="false" id="key" %}
    <div id="keyShow">SHOW</div>    
    <span class="input-wrap">
      <input type="checkbox" name="saveId" id="saveId" style="cursor: hand; cursor: pointer">
      <label for="saveId">
        <span></span></label>
      아이디 저장
    </span>
    <button class="pos-btn my-2" type='submit' content='로그인' id="checkKey">로그인</button>
    <p class="text-center mt-5">회원이 아니신가요?
      <a class="to-signup" href="{% url 'accounts:signup' %}">
        <b>회원가입<i class="bi bi-person-fill-add"></i>
        </b>
      </a>
    </p>
  </form>
  <p>또는</p>
  <p>SNS계정으로 간편 로그인/회원가입</p>
  <!--소셜 로그인 버튼 모음-->
  <div class="d-flex justify-content-center my-0">
    <form action="/accounts/google/login/" method="post">
      {% csrf_token %}
      <button class="btn btn-link my-2 my-sm-0 py-1" style="color : #FFFFFF" type="submit"
        onclick="document.getElementById('test').submit();"><img src="{% static 'img/google.png' %}" alt="구글"
          style="height:35px;"></button>
    </form>
    <form class="mx-1" action="/accounts/kakao/login/" method="post">
      {% csrf_token %}
      <button class="btn btn-link my-2 my-sm-0 py-1" style="color : #FFFFFF" type="submit"
        onclick="document.getElementById('test').submit();"><img src="{% static 'img/kakao.png' %}" alt="카카오"
          style="height:35px;"></button>
    </form>
    <form action="/accounts/naver/login/" method="post">
      {% csrf_token %}
      <button class="btn my-2 my-sm-0 btn-l py-1" style="color : #FFFFFF" type="submit"
        onclick="document.getElementById('test').submit();"><img src="{% static 'img/naver.png' %}" alt="네이버"
          style="height:35px;"></button>
    </form>
  </div>
</section>
{% endblock content %}
{% block script %}
<script>
  //아이디 기억하기 
  $(function () {
    fnInit();
  });

  function frm_check() {
    saveid();
  }
  
  function fnInit() {
    var cookieid = getCookie("saveid");
    console.log(cookieid);
    if (cookieid != "") {
      $("input:checkbox[id='saveId']").prop("checked", true);
      $('#logId').val(cookieid);
    }
  }

  function setCookie(name, value, expiredays) {
    var todayDate = new Date();
    todayDate.setTime(todayDate.getTime() + 0);
    if (todayDate > expiredays) {
      document.cookie = name + "=" + escape(value) + "; path=/; expires=" + expiredays + ";";
    } else if (todayDate < expiredays) {
      todayDate.setDate(todayDate.getDate() + expiredays);
      document.cookie = name + "=" + escape(value) + "; path=/; expires=" + todayDate.toGMTString() + ";";
    }
    console.log(document.cookie);
  }

  function getCookie(Name) {
    var search = Name + "=";
    console.log("search : " + search);
    if (document.cookie.length > 0) { // 쿠키가 설정되어 있다면
      offset = document
        .cookie
        .indexOf(search);
      console.log("offset : " + offset);
      if (offset != -1) { // 쿠키가 존재하면
        offset += search.length;
        // set index of beginning of value
        end = document
          .cookie
          .indexOf(";", offset);
        console.log("end : " + end);
        // 쿠키 값의 마지막 위치 인덱스 번호 설정
        if (end == -1) 
          end = document.cookie.length;
        console.log("end위치  : " + end);
        return unescape(document.cookie.substring(offset, end));
      }
    }
    return "";
  }

  function saveid() {
    var expdate = new Date();
    if ($("#saveId").is(":checked")) {
      expdate.setTime(expdate.getTime() + 1000 * 3600 * 24 * 30);
      setCookie("saveid", $("#logId").val(), expdate);
    } else {
      expdate.setTime(expdate.getTime() - 1000 * 3600 * 24 * 30);
      setCookie("saveid", $("#logId").val(), expdate);
    }
  }
</script>
<script>
  // 비밀번호 보이기
  $("#key").on("keyup", function(event) {
    if (event.keyCode === 13) {
      event.preventDefault();
      $("#checkKey").triggerHandler("click");
    } else {
      if (this.value) {
        $("#keyShow").css("display", "inline-block");
      } else {
        $("#keyShow").hide();
      }
    }
  }).focus();
  
  $("#keyShow").on("click", function() {
    if ($("#key").attr("type") == "password") {
      $("#key").attr("type", "text");
      $($(this)).text("H I D E");
    } else {
      $("#key").attr("type", "password");
      $($(this)).text("SHOW");
    }
  });
</script>
<script>
// JavaScript for label effects only
$(window).load(function(){
  $(".col-3 input").val("");
  
  $(".input-effect input").focusout(function(){
    if($(this).val() != ""){
      $(this).addClass("has-content");
    }else{
      $(this).removeClass("has-content");
    }
  })
});
</script>
{% endblock script %}