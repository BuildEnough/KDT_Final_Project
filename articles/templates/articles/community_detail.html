{% extends 'base.html' %}

{% load static %}
{% load widget_tweaks %}
{% load django_bootstrap5 %}
{% load imagekit %}

{% block title %}{% endblock title %}
{% block style %}{% endblock style %}
{% block content %}

<br><br><br><br>

{% comment %} <main class="container w-50">
  <div class="d-flex justify-content-between my-1 mt-5">
      <div class="d-flex my-3" onclick='location.href=""' style='cursor: pointer;'>
          <div class='me-2'>
            {% if user.image %}
            <img src="{{ user.image.url }}" class="profile" alt="abc" style='width:3rem;height:3rem' class='rounded-circle'>
            {% endif %}
          </div>
          <div class='d-flex flex-column'>
              <p class='p-0 mb-0 text-start fw-bold'></p>
              <p class='p-0 mb-0 fw-light'></p>
          </div>
      </div>
  </div> {% endcomment %}

  
  
  <div class="slideshow-container">
    {% for i in community.communityimages_set.all %}
    <div class="mySlides">
      <div class="numbertext">{{ forloop.counter }} / {{ community.communityimages.count }}</div>
      <img src="{{ i.images.url }}" style="width:100%">
    </div>
    {% endfor %}
    
    <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
    <a class="next" onclick="plusSlides(1)">&#10095;</a>
  </div>
  <br>
  
  
  <div class="d-flex flex-row justify-content-around">
    <div>
      <a href="{% url 'articles:community_update' community.pk %}">글 수정&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
    </div>
    <div>
      {% for i in community.communityimages_set.all %}
      <span class="dot" onclick="currentSlide({{ forloop.counter }})"></span>
      {% endfor %}
    </div>
    <div>
      <a href="{% url 'articles:community_index' %}">커뮤니티 메인</a>
    </div>
  </div>
</main>

<div class="container text-center">
  <p>{{ community.content|safe }}</p>
</div>


{% if request.user.is_authenticated %}
<form id="comment-form" data-community-id="{{ community.pk }}">
  {% csrf_token %}
  {% bootstrap_form community_comment_form layout='inline' %}
  {% bootstrap_button button_type="submit" content="댓글 작성"%}
</form>
{% endif %}




<div id="comments">
{% for comment in comments %}
<p>{{ comment.user.username }} | {{ comment.content }}</p>
{% empty %}
  <p>댓글 없엉</p>
<hr>
{% endfor %}
</div>

{% endblock content %}
{% block script %}
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
  let slideIndex = 1;
  showSlides(slideIndex);
  
  function plusSlides(n) {
    showSlides(slideIndex += n);
  }
  
  function currentSlide(n) {
    showSlides(slideIndex = n);
  }
  
  function showSlides(n) {
  let i;
  let slides = document.getElementsByClassName("mySlides");
  let dots = document.getElementsByClassName("dot");
  if (n > slides.length) {slideIndex = 1}
  if (n < 1) {slideIndex = slides.length}
  for (i = 0; i < slides.length; i++) {
    slides[i].style.display = "none";
  }
  for (i = 0; i < dots.length; i++) {
    dots[i].className = dots[i].className.replace(" active", "");
  }
  slides[slideIndex-1].style.display = "block";
  dots[slideIndex-1].className += " active";
  }
</script>

<script>
  // 댓글
  const commentForm = document.querySelector('#comment-form')

  const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value
  commentForm.addEventListener('submit', function() {
    event.preventDefault();
    axios({
      method: 'post',
      url: `/${event.target.dataset.communityId}/community_comment_create/`,
      headers: {'X-CSRFToken': csrftoken},
      data: new FormData(commentForm)
    })
    .then(response => {
      console.log(response.data)
      const comments = document.querySelector('#comments')
      // const p = document.createElement('p')
      // p.innerText = `${response.data.userName} | ${response.data.content}`
      // const hr = document.createElement('hr')
      // comments.append(p, hr)
      comments.insertAdjacentHTML('beforeend', `
      <p>${ response.data.userName } | ${ response.data.content }</p>
      `)
      commentForm.reset()
    })
  })
</script>
{% endblock script %}